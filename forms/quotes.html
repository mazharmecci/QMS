<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quote Builder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 14px;
      margin: 20px;
    }

    table.quote-table {
      width: 100%;
      border-collapse: collapse;
    }

    table.quote-table th,
    table.quote-table td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      vertical-align: top;
    }

    table.quote-table th {
      background-color: #f5f5f5;
      text-align: left;
    }

    .unitPriceInput,
    .totalPriceInput {
      width: 100%;
      box-sizing: border-box;
      padding: 2px 4px;
    }
  </style>
</head>
<body>

  <h1>Quote</h1>

  <table class="quote-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Cat / Material No. &amp; Description</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Total Price</th>
      </tr>
    </thead>
    <tbody id="quoteTableBody">
      <!-- Rows injected by JavaScript -->
    </tbody>
  </table>

  <script>
    // ---------- Reusable stacked cell formatter ----------
    function formatStackedQuoteCell({ code = '', name = '', description = '' }) {
      const descLines = description
        ? description.split(/(?<=\.)\s+/)   // split by sentence end if possible
        : [];
      const formattedDesc = descLines.join('\n');

      return `
        <td style="white-space:pre-line; vertical-align:top;">
          <div style="font-size:13px; font-weight:600;">${code}</div>
          <div style="font-size:12px; font-weight:500; color:#222;">${name}</div>
          <div style="font-size:11px; color:#555;">${formattedDesc}</div>
        </td>
      `;
    }

    // ---------- Main instrument row ----------
    function renderMainInstrumentRow(inst) {
      const rows = [];

      rows.push(`
        <tr>
          <td>001</td>
          ${formatStackedQuoteCell({
            code: inst.catalog || '',
            name: inst.instrumentName || inst.description || '',
            description: inst.details || inst.description || ''
          })}
          <td>01</td>
          <td><input type="text" value="${inst.unitPrice || '0.00'}" class="unitPriceInput"></td>
          <td><input type="text" value="${inst.unitPrice || '0.00'}" class="totalPriceInput"></td>
        </tr>
      `);

      return rows.join('');
    }

    // ---------- Configuration rows ----------
    function renderConfigRows(configItems) {
      const rows = [];

      configItems.forEach((item, idx) => {
        const lineNo = String(idx + 2).padStart(3, '0'); // starts at 002

        rows.push(`
          <tr>
            <td>${lineNo}</td>
            ${formatStackedQuoteCell({
              code: item.itemCode || '',
              name: item.itemName || '',
              description: item.catalogRef || ''
            })}
            <td>01</td>
            <td>0.00</td>
            <td>0.00</td>
          </tr>
        `);
      });

      return rows.join('');
    }

    // ---------- Additional item rows ----------
    function renderAdditionalRows(additionalItems) {
      const rows = [];

      additionalItems.forEach((item, idx) => {
        const lineNo = String(idx + 1).padStart(3, '0'); // restarts at 001 or adjust as you wish

        rows.push(`
          <tr>
            <td>${lineNo}</td>
            ${formatStackedQuoteCell({
              code: item.itemCode || '',
              name: item.itemName || '',
              description: item.catalogRef || ''
            })}
            <td>01</td>
            <td>0.00</td>
            <td>0.00</td>
          </tr>
        `);
      });

      return rows.join('');
    }

    // ---------- Main render function ----------
    function renderQuoteBuilder(inst, configItems = [], additionalItems = []) {
      const tableBody = document.getElementById('quoteTableBody');

      const mainInstrumentHtml = renderMainInstrumentRow(inst);
      const configHtml = renderConfigRows(configItems);
      const additionalHtml = renderAdditionalRows(additionalItems);

      tableBody.innerHTML = mainInstrumentHtml + configHtml + additionalHtml;
    }

    // ---------- Example data (replace with your real data) ----------
    const exampleInstrument = {
      catalog: '0300610',
      instrumentName: 'pfm Rotary 3006 EM (Fully-Electronic Microtome)',
      description: 'The pfm Rotary 3006 EM is a modern, newly-designed semi-electronic rotary microtome for all applications in routine use, research and industry.',
      details: '',
      unitPrice: '10000.00'
    };

    const exampleConfigItems = [
      {
        itemCode: 'CFG-001',
        itemName: 'Standard Knife Holder',
        catalogRef: 'Holds blades securely; suitable for routine microtomy.'
      },
      {
        itemCode: 'CFG-002',
        itemName: 'Waste Tray',
        catalogRef: 'Collects trimming waste and sectioning debris.'
      }
    ];

    const exampleAdditionalItems = [
      {
        itemCode: 'ADD-001',
        itemName: 'Starter Consumables Kit',
        catalogRef: 'Includes blades, brushes and basic accessories for initial setup.'
      }
    ];

    // ---------- Initial render ----------
    renderQuoteBuilder(exampleInstrument, exampleConfigItems, exampleAdditionalItems);
  </script>

</body>
</html>
