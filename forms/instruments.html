<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QMS - Instruments</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body { font-family:'Inter',sans-serif; background:#f5f7fa; margin:0; }
    header { background:#0d6efd; color:#fff; padding:0.75rem 1.5rem; }
    .header-inner { max-width:1200px; margin:0 auto; display:flex; align-items:center; gap:12px; }
    .back-btn { border:none; background:rgba(255,255,255,0.12); color:#fff; padding:0.45rem 0.9rem; border-radius:999px; cursor:pointer; }
    .header-title { flex:1; text-align:center; font-weight:600; font-size:1.5rem; }
    .container { max-width:1200px; margin:2rem auto; padding:2rem; background:#fff; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    .top-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
    .top-bar h2 { color:#0d6efd; margin:0; }
    .top-bar button { background:#0d6efd; color:#fff; border:none; padding:0.6rem 1rem; border-radius:8px; cursor:pointer; }

    form { display:none; grid-template-columns:1fr 1fr; gap:1rem; margin:1rem 0 2rem; }
    form.active { display:grid; }
    form input, form select, form button { padding:0.8rem; border:1px solid #ccc; border-radius:8px; font-size:0.95rem; }
    #detailsEditor { grid-column:span 2; height:150px; background:#fff; border:1px solid #ccc; border-radius:8px; }
    form button[type="submit"] { grid-column:span 2; background:#0d6efd; color:#fff; border:none; cursor:pointer; }

    table { width:100%; border-collapse:separate; border-spacing:0 8px; margin-top:1rem; }
    thead th { padding:0.8rem; background:#f0f4f8; border-bottom:1px solid #ddd; text-align:left; }
    tbody tr { background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.04); }
    td { padding:0.8rem; border-top:1px solid #eee; border-bottom:1px solid #eee; vertical-align:top; }
    tbody tr td:first-child { border-left:1px solid #eee; border-radius:8px 0 0 8px; }
    tbody tr td:last-child { border-right:1px solid #eee; border-radius:0 8px 8px 0; }
    .actions { white-space:nowrap; }
    .actions button { margin-right:0.5rem; padding:0.4rem 0.8rem; border:none; border-radius:6px; cursor:pointer; font-size:0.85rem; }
    .edit-btn { background:#ffc107; }
    .delete-btn { background:#dc3545; color:#fff; }
    .pagination { margin-top:1rem; text-align:center; }
    .pagination button { margin:0 0.5rem; padding:0.4rem 0.8rem; border:none; border-radius:6px; background:#0d6efd; color:#fff; cursor:pointer; }

    .collapse-toggle { cursor:pointer; color:#0d6efd; font-weight:600; font-size:0.9rem; margin-bottom:0.25rem; user-select:none; }
    .details-content, .optional-content, .config-content { display:none; font-size:0.9rem; margin-top:0.5rem; }
    .price-cell { font-weight:600; white-space:nowrap; }

    .modal { display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#fff; padding:2rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:1000; width:600px; }
    .modal h3 { margin-bottom:1rem; }
    .modal-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .modal input { padding:0.8rem; border:1px solid #ccc; border-radius:8px; font-size:0.95rem; }
    .modal-actions { margin-top:1rem; text-align:right; }
    .modal-actions button { padding:0.6rem 1rem; border-radius:8px; border:none; cursor:pointer; }
    .save-btn { background:#0d6efd; color:#fff; }
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <button type="button" class="back-btn" onclick="goBack()">← Back</button>
    <div class="header-title">QMS - Instruments</div>
  </div>
</header>

<div class="container">
  <div class="top-bar">
    <h2>Instrument Master</h2>
    <button onclick="toggleForm()">Add Instrument</button>
  </div>

  <form id="instrumentForm">
    <input type="text" id="description" placeholder="Instrument Description" required>
    <div id="detailsEditor"></div>
    <input type="text" id="origin" placeholder="Country Of Origin">
    <input type="text" id="catalog" placeholder="Catalog Reference">
    <input type="text" id="hsn" placeholder="HSN Code (1234 5678)" maxlength="9">
    <input type="text" id="instrumentCode" placeholder="Instrument Code (for quotes)">
    <input type="text" id="unitPrice" placeholder="Unit Price (₹)">
    <input type="text" id="gstType" placeholder="GST Type">
    <input type="number" id="gstPercent" placeholder="GST %">
    <button type="submit">Save Instrument</button>
  </form>

  <table id="instrumentTable">
    <thead>
      <tr>
        <th>Description</th>
        <th>Details</th>
        <th>Origin</th>
        <th>Catalog</th>
        <th>HSN</th>
        <th>Code</th>
        <th>Unit Price</th>
        <th>GST Type</th>
        <th>GST %</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pagination">
    <button onclick="prevPage()">Prev</button>
    <span id="pageInfo"></span>
    <button onclick="nextPage()">Next</button>
  </div>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
  const form = document.getElementById('instrumentForm');
  const tableBody = document.querySelector('#instrumentTable tbody');
  const pageInfo = document.getElementById('pageInfo');
  const hsnInput = document.getElementById('hsn');
  const unitPriceInput = document.getElementById('unitPrice');

  let instruments = JSON.parse(localStorage.getItem('instruments') || '[]');
  let currentPage = 1;
  const pageSize = 10;
  let editIndex = null;

  const quill = new Quill('#detailsEditor', {
    theme: 'snow',
    placeholder: 'Enter instrument details...',
    modules: { toolbar: [['bold','italic','underline'],[{list:'ordered'},{list:'bullet'}],[{header:[1,2,3,false]}],['link']] }
  });

  function goBack(){ if(window.history.length>1) window.history.back(); }

  function toggleForm(){ form.classList.toggle('active'); }

  hsnInput.addEventListener('input', () => {
    let digits = hsnInput.value.replace(/\D/g,'').slice(0,8);
    if(digits.length>4) digits = digits.slice(0,4)+' '+digits.slice(4);
    hsnInput.value = digits;
  });

  unitPriceInput.addEventListener('input', () => {
    let digits = unitPriceInput.value.replace(/[^\d]/g,'');
    if(!digits){ unitPriceInput.value=''; return; }
    const num = parseInt(digits,10);
    unitPriceInput.value = '₹ '+num.toLocaleString('en-IN');
  });

  function parsePriceValue(v){
    const digits = (v||'').replace(/[^\d]/g,'');
    return digits ? parseInt(digits,10) : 0;
  }

  form.addEventListener('submit', e=>{
    e.preventDefault();
    const instrument = {
      description: document.getElementById('description').value,
      details: quill.root.innerHTML,
      origin: document.getElementById('origin').value,
      catalog: document.getElementById('catalog').value,
      hsn: hsnInput.value,
      instrumentCode: document.getElementById('instrumentCode').value,
      unitPrice: parsePriceValue(unitPriceInput.value),
      gstType: document.getElementById('gstType').value,
      gstPercent: document.getElementById('gstPercent').value
    };
    if(editIndex!==null){ instruments[editIndex]=instrument; editIndex=null; }
    else instruments.push(instrument);
    localStorage.setItem('instruments', JSON.stringify(instruments));
    form.reset(); quill.setContents([]); unitPriceInput.value='';
    form.classList.remove('active');
    renderTable();
  });

  function formatPriceDisplay(v){ return '₹ '+Number(v||0).toLocaleString('en-IN'); }

  function renderTable(){
    tableBody.innerHTML='';
    const start=(currentPage-1)*pageSize, end=start+pageSize;
    instruments.slice(start,end).forEach((inst,i)=>{
      const idx = start+i;
      const row=document.createElement('tr');
      row.innerHTML=`
        <td>${inst.description}</td>
        <td>
          <div class="collapse-toggle" onclick="toggleDetails(this)">Details</div>
          <div class="details-content">${inst.details||''}</div>
        </td>
        <td>${inst.origin||''}</td>
        <td>${inst.catalog||''}</td>
        <td>${inst.hsn||''}</td>
        <td>${inst.instrumentCode||''}</td>
        <td class="price-cell">${formatPriceDisplay(inst.unitPrice)}</td>
        <td>${inst.gstType||''}</td>
        <td>${inst.gstPercent||''}</td>
        <td class="actions">
          <button class="edit-btn" onclick="editInstrument(${idx})">Edit</button>
          <button class="delete-btn" onclick="deleteInstrument(${idx})">Delete</button>
        </td>`;
      tableBody.appendChild(row);
    });
    pageInfo.textContent=`Page ${currentPage} of ${Math.ceil(instruments.length/pageSize)||1}`;
  }

  function toggleDetails(el){
    const d=el.nextElementSibling;
    const v=d.style.display==='block';
    d.style.display=v?'none':'block';
    el.textContent=v?'Details':'Hide details';
  }

  function editInstrument(i){
    const inst=instruments[i];
    document.getElementById('description').value=inst.description;
    document.getElementById('origin').value=inst.origin||'';
    document.getElementById('catalog').value=inst.catalog||'';
    hsnInput.value=inst.hsn||'';
    document.getElementById('instrumentCode').value=inst.instrumentCode||'';
    unitPriceInput.value=formatPriceDisplay(inst.unitPrice);
    document.getElementById('gstType').value=inst.gstType||'';
    document.getElementById('gstPercent').value=inst.gstPercent||'';
    quill.root.innerHTML=inst.details||'';
    editIndex=i;
    form.classList.add('active');
  }

  function deleteInstrument(i){
    instruments.splice(i,1);
    localStorage.setItem('instruments', JSON.stringify(instruments));
    const maxPage=Math.max(1,Math.ceil(instruments.length/pageSize));
    if(currentPage>maxPage) currentPage=maxPage;
    renderTable();
  }

  function nextPage(){ if(currentPage*pageSize<instruments.length){ currentPage++; renderTable(); } }
  function prevPage(){ if(currentPage>1){ currentPage--; renderTable(); } }

  renderTable();
</script>
</body>
</html>
